(function(){var c={};var u=40;var v=38;var o=27;var l=13;var B=[32,59,186,188,190];function p(a){return a.options==null&&typeof a!="boolean"?a.split(","):a.options}tinymce.create('tinymce.plugins.AutoCompletePlugin',{setOptions:function(a){c.options=p(a)},getOptions:function(){return c.options},init:function(h,L){c={list:C(),visible:false,cancelEnter:false,delimiter:h.getParam('autocomplete_delimiters','160,32').split(","),options:p(h.getParam('autocomplete_options','')),optionsUrl:p(h.getParam('autocomplete_options_url',false)),trigger:h.getParam('autocomplete_trigger','@'),enclosing:h.getParam('autocomplete_end_option',''),minLength:h.getParam('autocomplete_min_length','3'),onSelect:h.getParam('autocomplete_on_select',false),onMatch:h.getParam('autocomplete_on_match',false)};var j=this;if(c.onSelect){j.onSelect=new tinymce.util.Dispatcher(j);j.onSelect.add(function(a,b){a.execCallback('autocomplete_on_select',a,b)})}if(c.onMatch){j.onMatch=new tinymce.util.Dispatcher(j);j.onMatch.add(function(a,b){a.execCallback('autocomplete_on_match',a,b)})}function D(a,b){if((!c.visible&&b.keyCode!=o&&b.keyCode!=l)||(b.keyCode!=u&&b.keyCode!=v&&b.keyCode!=l&&b.keyCode!=o)){var d=m(a);var e=n(d);if(d.length>0){E(d)}if(d.length==0||e.length==0){k()}}}function E(e){var f=e.replace(c.trigger,"");if(c.optionsUrl){if(f.length<=1)return false;jQuery.ajax({type:"GET",url:c.optionsUrl,cache:false,data:"q="+f,success:function(a){if(a.ok&&a.DATA){var b=[];for(var d in a.DATA){if(a.DATA[d].name)b.push(a.DATA[d].name)}c.options=b;matches=n(f);if(matches.length>0){w(matches,f,h);q()}}else{}},error:function(a,b){}})}else{matches=n(f);if(matches.length>0){w(matches,f,h);q()}}}function F(a,b){if(b.keyCode==l&&c.cancelEnter){c.cancelEnter=false;return tinymce.dom.Event.cancel(b)}}function G(a,b){if(c.visible){if(b.keyCode==u){q();return tinymce.dom.Event.cancel(b)}if(b.keyCode==v){H();return tinymce.dom.Event.cancel(b)}if(b.keyCode==l){x(a,m(a));c.cancelEnter=true;return}if(b.keyCode==o){k();return tinymce.dom.Event.cancel(b)}if(c.onMatch&&B.indexOf(b.keyCode)){var d=m(a);var e=n(d);var f=new RegExp("^"+e[0]+"$","i");if(e.length==1&&d.match(f)){j.onMatch.dispatch(a,e[0])}}}}function I(a,b){k()}function w(a,b,d){var e="";var f=new RegExp("("+b+")");for(var g in a){if(a[g].key!=null){e+="
"+a[g].key.replace(f,"$1")+" "+a[g].description+"
"}else{e+="
"+a[g].replace(f,"$1")+"
"}}jQuery(c.list).html(e);var i=jQuery(d.getContainer()).position();var r=jQuery(d.getContainer()).find(".mceToolbar").first();var y=jQuery(d.selection.getNode()).position();var s=0;var t=0;if(d.selection.getRng().getClientRects().length>0){s=d.selection.getRng().getClientRects()[0].top+d.selection.getRng().getClientRects()[0].height;t=d.selection.getRng().getClientRects()[0].left}else{s=parseInt(jQuery(d.selection.getNode()).css("font-size"))*1.3+y.top;t=y.left}jQuery(c.list).css("margin-top",i.top+r.innerHeight()+s);jQuery(c.list).css("margin-left",i.left+t);jQuery(c.list).css("display","block");c.visible=true;J(d)}function J(a){jQuery(c.list).find("li").hover(function(){jQuery(c.list).find("[data-selected=true]").attr("data-selected","false");jQuery(this).attr("data-selected","true")});jQuery(c.list).find("li").click(function(){x(a,m(a))})}function C(){var a=document.createElement("ul");jQuery(a).addClass("auto-list");document.body.appendChild(a);return a}function k(){jQuery(c.list).css("display","none");c.visible=false}function q(){var a=jQuery(c.list).find("[data-selected=true]");if(a.size()==0||a.next().size()==0){jQuery(c.list).find("li:first-child").attr("data-selected","true")}else{a.next().attr("data-selected","true")}a.attr("data-selected","false")}function H(){var a=jQuery(c.list).find("[data-selected=true]");if(a.size()==0||a.prev().size()==0){jQuery(c.list).find("li:last-child").attr("data-selected","true")}else{a.prev().attr("data-selected","true")}a.attr("data-selected","false")}function x(a,b){var d=jQuery(c.list).find("[data-selected=true]").attr("data-value");if(d==null){d=jQuery(c.list).find("li:first-child").attr("data-value")}var e=z(a.selection.getSel().anchorNode,"");var f=a.selection.getSel().anchorNode.textContent;var g=a.selection.getRng();g.setStart(g.startContainer,g.startOffset-b.length);a.selection.setRng(g);var i="";if(c.delimiter.length>0){i=String.fromCharCode(c.delimiter[0])}a.selection.setContent(c.trigger+d.text()+i);if(c.enclosing.length>0&&!K(e,f)){var r=a.selection.getBookmark();a.selection.setContent(i+c.trigger+c.enclosing);a.selection.moveToBookmark(r)}k();if(c.onSelect){j.onSelect.dispatch(a,d)}k()}function K(a,b){var d=c.trigger+c.enclosing;a=a.substr(b.length);var e=new RegExp(c.trigger+".{"+c.enclosing.length+"}","g").exec(a);if(e!=null&&e.length>0&&e[0]==d){return true}return false}function z(a,b){b+=a.textContent;if(a.nextSibling!=null){return z(a.nextSibling,b)}return b}function n(a){var b=c.options;var d=[];for(var e in b){if(b[e].key==null&&(a.length==0||A(a,b[e]))){d.push(b[e])}else if(b[e].key!=null&&(a.length==0||A(a,b[e].key))){d.push(b[e])}}return d}function A(a,b){var d=new RegExp("^"+a,"i");return(b.match(d))}function m(a){var b=a.selection.getSel().focusNode==null?"":a.selection.getSel().focusNode.nodeValue;var d=a.selection.getSel().focusOffset;if(b==null||b.length==0){return""}var e=0;for(var f=0;f=c.minLength){i=g}}else{if(g.length>0&&g.charAt(0).toString()==c.trigger){i=g}}return i}h.onKeyUp.addToTop(D);h.onKeyDown.addToTop(G);h.onKeyPress.addToTop(F);h.onClick.add(I)},getInfo:function(){return{longname:'AutoComplete',author:'Mijura Pty Ltd',authorurl:'http://mijura.com',infourl:'http://blog.mijura.com',version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add('autocomplete',tinymce.plugins.AutoCompletePlugin)})();